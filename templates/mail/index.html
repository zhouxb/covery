{% extends 'base.html' %}

{% block nav %}
{% include "nav.html" %}
{% endblock %}

{% block content %}
{% load url from future %}

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span3">
            {% include "account/sidebar.html" %}
        </div>

        <div class="span9">
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                    <tr>
                        <th width="15"><input type='checkbox' id='select' name='all_id'/></th>
                        <th>来源</th>
                        <th>主题</th>
                        <th>已读</th>
                        <th>已发送</th>
                        <th>时间</th>
                        <th width="60">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mail in mails.object_list %}
                    <tr id="tr_mail_{{ mail.id }}">
                        <td><input type='checkbox' id='{{mail.id}}' name='item_id'/></td>
                        <td>{{ mail.from_email }}</td>
                        <td>{{ mail.subject }}</td>

                        <td>
                        {% if mail.is_readed %}
                        <span class="label label-success">Yes</span>
                        {% else %}
                        <span class="label label-warning">No</span>
                        {% endif %}
                        </td>

                        <td>
                        {% if mail.is_sended %}
                        <span class="label label-success">Yes</span>
                        {% else %}
                        <span class="label label-warning">No</span>
                        {% endif %}
                        </td>

                        <td>{{ mail.date_joined|date:"Y-m-d H:i:s" }}</td>
                        <td>
                            <a href="#" onclick="show('{% url "mail:show" mail.id %}');"><i class="icon-comment"></i></a>
                            <a href="#" onclick="remove('{% url "mail:delete" mail.id %}', {{ mail.id }});"><i class="icon-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% with mails as pages %}
            {% include "util/pagination.html" %}
            {% endwith%}

        </div>
    </div>
</div>

{% include "crawler/opertion_message.html" %}
<script>
    function remove(url, id){
        bootbox.confirm("你确定删除么?", function(result){
            if (result) {
                $.get(url, function(data){
                    if(data["result"]=="success"){
                        $("#tr_mail_" + id).fadeOut(1000, function(){ $("#tr_mail_" + id).remove });
                        }else{
                        imessage("删除失败", "error");
                    }
                })
                } else {
            }
        });
    }

    function show(url){
        window.open(url);
    }

</script>

{% endblock %}

