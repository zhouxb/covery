
{% extends 'base.html' %}

{% block nav %}
{% include "nav.html" %}
{% endblock %}

{% block content %}
{% load url from future %}

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span3">
      {% include "isp/sidebar.html" %}
    </div>
    <div class="span9">
      <h3><a href="{% url 'pbl:device_survey_index' province.id %}">{{ province.name }}</a></h3>

      {% for survey_device in survey_devices %}
      <div id="{{ survey_device.survey.operator }}" class="span3 well">
        <h3>{{ survey_device.survey.operator }}</h3>
        {% for device in survey_device.devices %}
        <li name="device_li"><div class="alert alert-info" value="{{ device.id }}">{{ device.sn }}</div></li>
        {% endfor %}
      </div>
      {% endfor %}

    </div>
  </div>
</div>

<script src="{{ STATIC_URL }}js/jquery-ui-1.8.19.custom.min.js"></script>
<script>
  $(function() {
    {% for survey_device in survey_devices %}
    $operator= $("#{{ survey_device.survey.operator }}")
    $operator.data("survey_id", "{{ survey_device.survey.id }}")
    $( "li", $operator ).draggable({
      revert: true,
      cursor: "move"
    });

    $operator.droppable({
      accept: "li[name='device_li']",
      drop: function( event, ui ) {
        $p = $(this)
        $item = ui.draggable;
        survey_id = $p.data('survey_id')
        device_id = $('div',$item).attr("value")

        $item.fadeOut(function() {
          $.post("{% url 'pbl:device_survey_update_json' province.id %}", {survey_id:survey_id, device_id:device_id},
          function(data){
            if(data["result"]=="success"){
              $item.appendTo($p).fadeIn(function(){});
            }
          });
        });
      }
    });

    {% endfor %}
  });

</script>

{% endblock %}

