{% extends 'base.html' %}

{% block nav %}
{% include "nav.html" %}
{% endblock %}

{% block content %}

<div class="container-fluid">
  <div class="row-fluid">

    {% include "account/sidebar.html" %}

    <div class="span9">

      {% include "util/message_success.html" %}

      <div class="btn-toolbar" style="margin-bottom: 9px">
        <div class="btn-group">
          <a id="a_enable"class="btn btn-success" href="#"><i class="icon-ok icon-white"></i> 可用</a>
          <a id="a_disable"class="btn btn-danger" href="#"><i class="icon-remove icon-white"></i> 不可用</a>
        </div>
        <div class="btn-group">
        <a class="btn btn-primary" href="/account/device/new"><i class="icon-plus icon-white"></i> 添加设备</a>
        </div>
      </div>

      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th width="15"><input type='checkbox' id='select' name='device_ids'/></th>
            <th width="40">部门</th>
            <th width="100">兆维机房IP</th>
            <th width="100">外网IP</th>
            <th width="100">资产编号</th>
            <th>类型</th>
            <th>系统</th>
            <th width="40">状态</th>
            <th width="40">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for device in devices %}
          <tr>
            <td><input type='checkbox' id='{{device.id}}' name='device_id'/></td>
            <td>{{ device.get_department_display }}</td>
            <td>{{ device.intranet_ip }}</td>
            <td>{{ device.external_ip }}</td>
            <td>{{ device.sn }}</td>
            <td>{{ device.type }}</td>
            <td>{{ device.os }}</td>

            {% if device.status == '1' %}
            <td><span class="label label-success">{{ device.get_status_display }}</span></td>
            {% endif %}
            {% if device.status == '2' %}
            <td><span class="label label-important">{{ device.get_status_display }}</span></td>
            {% endif %}
            {% if device.status == '0' %}
            <td><span class="label label-warning">{{ device.get_status_display }}</span></td>
            {% endif %}

            <td>
              <a href="/account/device/{{ device.id }}/show"><i class="icon-edit"></i></a>
              <a href="#" onclick="a_delete({{ device.id }});" ><i class="icon-trash"></i></a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% include "device/delete.html" %}

<script>
  $(document).ready(function(){
    $("#select").click(function(){
      if($(this).attr("checked")==undefined){
        $("[type='checkbox']").removeAttr("checked");
        }else{
        $("[type='checkbox']").attr("checked", 'true');
      }
    });
  });

  $(document).ready(function(){
    $("#a_enable").click(function(){
      device_status_update("1")
    });

    $("#a_disable").click(function(){
      device_status_update("2")
    });
  });

  function device_status_update(status){
    var params = "device_ids=";
    var select = document.getElementsByName('device_id')
    var values = new Array()
    for(var i=0; i<select.length; i++){
      if(select[i].checked){
        values.push(select[i].id)
      }
    }

    if(values.length != 0){
      params += values.join("|");
      params += "&status=" + status
      location.href = "/account/device/update_status?" + params;
    }
  }

</script>

{% endblock %}

